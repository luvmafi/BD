CREATE SEQUENCE secv_angajat START WITH 1 INCREMENT BY 1;

CREATE TABLE Angajat (
    ID_ANGAJAT INT,
    NUME_ANGAJAT VARCHAR(24) NOT NULL,
    SALARIU_ANGAJAT INT NOT NULL,
    DATA_ANGAJARII DATE NOT NULL,
    PRIMARY KEY (ID_ANGAJAT)
);

INSERT INTO ANGAJAT(id_angajat, nume_angajat, salariu_angajat, data_angajarii)
VALUES (secv_angajat.NEXTVAL, 'Ana Maria', 3000, TO_DATE('2022-01-15', 'YYYY-MM-DD'));
INSERT INTO Angajat (ID_ANGAJAT, NUME_ANGAJAT, SALARIU_ANGAJAT, DATA_ANGAJARII)
VALUES (secv_angajat.NEXTVAL, 'Robert Darius', 2500, TO_DATE('2022-03-10', 'YYYY-MM-DD'));
INSERT INTO Angajat (ID_ANGAJAT, NUME_ANGAJAT, SALARIU_ANGAJAT, DATA_ANGAJARII)
VALUES (secv_angajat.NEXTVAL, 'Popescu Ion', 3500, TO_DATE('2022-02-01', 'YYYY-MM-DD'));
INSERT INTO Angajat (ID_ANGAJAT, NUME_ANGAJAT, SALARIU_ANGAJAT, DATA_ANGAJARII)
VALUES (secv_angajat.NEXTVAL, 'Maria Pop', 2800, TO_DATE('2022-04-20', 'YYYY-MM-DD'));
INSERT INTO Angajat (ID_ANGAJAT, NUME_ANGAJAT, SALARIU_ANGAJAT, DATA_ANGAJARII)
VALUES (secv_angajat.NEXTVAL, 'Ionut Popescu', 3200, TO_DATE('2022-05-05', 'YYYY-MM-DD'));

SELECT * FROM Angajat;
CREATE TABLE Departament (
    ID_DEPARTAMENT INT,
    NUME_DEPARTAMENT VARCHAR(12) NOT NULL,
    PRIMARY KEY (ID_DEPARTAMENT)
);

INSERT INTO Departament (ID_DEPARTAMENT, NUME_DEPARTAMENT)
VALUES (1, 'Depart IT');
INSERT INTO Departament (ID_DEPARTAMENT, NUME_DEPARTAMENT)
VALUES (2, 'Depart Sell');
INSERT INTO Departament (ID_DEPARTAMENT,NUME_DEPARTAMENT)
VALUES (3, 'Depart PR');
INSERT INTO Departament (ID_DEPARTAMENT, NUME_DEPARTAMENT)
VALUES (4, 'Depart HR');
INSERT INTO Departament (ID_DEPARTAMENT, NUME_DEPARTAMENT)
VALUES (5, 'Depart Int');

SELECT * FROM Departament;

CREATE TABLE ECHIPA(
    ID_ECHIPA INT,
    ID_DEPARTAMENT INT,
    NUME_ECHIPA VARCHAR(12) NOT NULL,
    NUMAR_TASKURI INT NOT NULL,
    PRIMARY KEY (ID_ECHIPA),
    FOREIGN KEY (ID_DEPARTAMENT) REFERENCES Departament(ID_DEPARTAMENT)
);
)
INSERT INTO Echipa (ID_ECHIPA, ID_DEPARTAMENT, NUME_ECHIPA, NUMAR_TASKURI)
VALUES (1, 1, 'Echipa 1', 10);
INSERT INTO Echipa (ID_ECHIPA, ID_DEPARTAMENT, NUME_ECHIPA, NUMAR_TASKURI)
VALUES (2, 2, 'Echipa 2', 8);
INSERT INTO Echipa (ID_ECHIPA, ID_DEPARTAMENT, NUME_ECHIPA, NUMAR_TASKURI)
VALUES (3, 3, 'Echipa 3', 6);
INSERT INTO Echipa (ID_ECHIPA, ID_DEPARTAMENT, NUME_ECHIPA, NUMAR_TASKURI)
VALUES (4, 3, 'Echipa 4', 5);
INSERT INTO Echipa (ID_ECHIPA, ID_DEPARTAMENT, NUME_ECHIPA, NUMAR_TASKURI)
VALUES (5, 3, 'Echipa 5', 7);

SELECT * from ECHIPA;

CREATE TABLE Proiect (
    ID_PROIECT INT,
    NUME_PROIECT VARCHAR2(20) NOT NULL,
    STADIU_PROIECT NUMBER(1) NOT NULL,
    DATA_PREZENTARE DATE NOT NULL,
    PRIMARY KEY (ID_PROIECT)
);

INSERT INTO Proiect (ID_PROIECT, NUME_PROIECT, STADIU_PROIECT, DATA_PREZENTARE)
VALUES (1, 'Proiect A', 0, TO_DATE('2023-05-20', 'YYYY-MM-DD'));
INSERT INTO Proiect (ID_PROIECT, NUME_PROIECT, STADIU_PROIECT, DATA_PREZENTARE)
VALUES (2, 'Proiect B', 1, TO_DATE('2023-06-15', 'YYYY-MM-DD'));
INSERT INTO Proiect (ID_PROIECT, NUME_PROIECT, STADIU_PROIECT, DATA_PREZENTARE)
VALUES (3, 'Proiect C', 0, TO_DATE('2023-07-10', 'YYYY-MM-DD'));
INSERT INTO Proiect (ID_PROIECT, NUME_PROIECT, STADIU_PROIECT, DATA_PREZENTARE)
VALUES (4, 'Proiect D', 1, TO_DATE('2023-08-05', 'YYYY-MM-DD'));
INSERT INTO Proiect (ID_PROIECT, NUME_PROIECT, STADIU_PROIECT, DATA_PREZENTARE)
VALUES (5, 'Proiect E', 1, TO_DATE('2023-09-01', 'YYYY-MM-DD'));

SELECT * FROM Proiect;

CREATE TABLE Director (
    ID_DIRECTOR INT,
    NUME_DIRECTOR VARCHAR2(24) NOT NULL,
    SALARIU_DIRECTOR INT NOT NULL,
    DATA_FUNCTIE DATE NOT NULL,
    PRIMARY KEY (ID_DIRECTOR)
);

INSERT INTO Director (ID_DIRECTOR, NUME_DIRECTOR, SALARIU_DIRECTOR, DATA_FUNCTIE)
VALUES (1,'Maftei Stefan', 5000, TO_DATE('2022-01-01', 'YYYY-MM-DD'));
INSERT INTO Director (ID_DIRECTOR, NUME_DIRECTOR, SALARIU_DIRECTOR, DATA_FUNCTIE)
VALUES (2, 'Andrei Serban', 6000, TO_DATE('2022-02-15', 'YYYY-MM-DD'));
INSERT INTO Director (ID_DIRECTOR, NUME_DIRECTOR, SALARIU_DIRECTOR, DATA_FUNCTIE)
VALUES (3, 'Botezatu Cosmin', 5500, TO_DATE('2022-03-10', 'YYYY-MM-DD'));
INSERT INTO Director (ID_DIRECTOR, NUME_DIRECTOR, SALARIU_DIRECTOR, DATA_FUNCTIE)
VALUES (4, 'Ursu Vlad', 5200, TO_DATE('2022-04-20', 'YYYY-MM-DD'));
INSERT INTO Director (ID_DIRECTOR, NUME_DIRECTOR, SALARIU_DIRECTOR, DATA_FUNCTIE)
VALUES (5, 'Rauta Robert', 5800, TO_DATE('2022-05-05', 'YYYY-MM-DD'));

SELECT * from Director;

CREATE TABLE Contract (
    ID_CONTRACT INT,
    ID_PROIECT INT,
    ID_DIRECTOR INT,
    CASTIG_CONTRACT INT NOT NULL,
    DATA_CONTRACT DATE NOT NULL,
    PRIMARY KEY (ID_CONTRACT),
    FOREIGN KEY (ID_PROIECT) REFERENCES Proiect(ID_PROIECT),
    FOREIGN KEY (ID_DIRECTOR) REFERENCES Director(ID_DIRECTOR)
);

INSERT INTO Contract (ID_CONTRACT, ID_PROIECT, ID_DIRECTOR, CASTIG_CONTRACT, DATA_CONTRACT)
VALUES (1, 1, 1, 5000, TO_DATE('2023-05-10', 'YYYY-MM-DD'));
INSERT INTO Contract (ID_CONTRACT, ID_PROIECT, ID_DIRECTOR, CASTIG_CONTRACT, DATA_CONTRACT)
VALUES (2, 2, 2, 8000, TO_DATE('2023-06-20', 'YYYY-MM-DD'));
INSERT INTO Contract (ID_CONTRACT, ID_PROIECT, ID_DIRECTOR, CASTIG_CONTRACT, DATA_CONTRACT)
VALUES (3, 3, 3, 6000, TO_DATE('2023-07-15', 'YYYY-MM-DD'));
INSERT INTO Contract (ID_CONTRACT, ID_PROIECT, ID_DIRECTOR, CASTIG_CONTRACT, DATA_CONTRACT)
VALUES (4, 4, 4, 10000, TO_DATE('2023-08-25', 'YYYY-MM-DD'));
INSERT INTO Contract (ID_CONTRACT, ID_PROIECT, ID_DIRECTOR, CASTIG_CONTRACT, DATA_CONTRACT)
VALUES (5, 5, 5, 7500, TO_DATE('2023-09-10', 'YYYY-MM-DD'));

SELECT * FROM Contract;

CREATE TABLE Relase (
    ID_ECHIPA INT,
    ID_PROIECT INT,
    FOREIGN KEY (ID_ECHIPA) REFERENCES Echipa(ID_ECHIPA),
    FOREIGN KEY (ID_PROIECT) REFERENCES Proiect(ID_PROIECT)
);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (1, 1);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (2, 1);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (3, 2);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (4, 2);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (5, 3);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (2, 3);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (1, 4);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (2, 4);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (3, 5);
INSERT INTO Relase (ID_ECHIPA, ID_PROIECT) VALUES (4, 5);


SELECT P.ID_PROIECT, COUNT(*) AS NUMAR_ECHIPE, AVG(E.NUMAR_TASKURI) AS MEDIE_TASKURI
FROM PROIECT P
JOIN RELASE R ON P.ID_PROIECT = R.ID_PROIECT
JOIN ECHIPA E ON R.ID_ECHIPA = E.ID_ECHIPA
GROUP BY P.ID_PROIECT
HAVING AVG(E.NUMAR_TASKURI) > (
    SELECT AVG(NUMAR_TASKURI)
    FROM ECHIPA
);

SELECT ID_ECHIPA, NVL(NUME_ECHIPA, 'N/A') AS NUME_ECHIPA,
    DECODE(NUMAR_TASKURI, 0, 'Fara task-uri', 'Cu task-uri') AS STARE_TASKURI
FROM ECHIPA
ORDER BY NUME_ECHIPA DESC;

SELECT NUME_ANGAJAT, TO_CHAR(DATA_ANGAJARII, 'YYYY') AS AN_ANGAJARE,
    UPPER(SUBSTR(NUME_ANGAJAT, 1, 1)) || LOWER(SUBSTR(NUME_ANGAJAT, 2)) AS NUME_MODIFICAT,
    CASE
        WHEN SALARIU_ANGAJAT >= 5000 THEN 'Salariu mare'
        WHEN SALARIU_ANGAJAT >= 3000 THEN 'Salariu mediu'
        ELSE 'Salariu mic'
    END AS CATEGORIE_SALARIU
FROM ANGAJAT;

WITH AngajatiSalariuMaxim AS (
    SELECT MAX(SALARIU_ANGAJAT) AS SALARIU_MAXIM
    FROM Angajat
)
SELECT a.ID_ANGAJAT, a.NUME_ANGAJAT, a.SALARIU_ANGAJAT
FROM Angajat a
JOIN AngajatiSalariuMaxim asm ON a.SALARIU_ANGAJAT = asm.SALARIU_MAXIM;

DELETE FROM Proiect
WHERE ID_PROIECT = (
    SELECT ID_PROIECT
    FROM Proiect
    WHERE NUME_PROIECT = 'Nume Proiect'
    AND STADIU_PROIECT = 0
    AND DATA_PREZENTARE < SYSDATE
);

UPDATE Angajat
SET SALARIU_ANGAJAT = SALARIU_ANGAJAT * 1.05
WHERE ID_ANGAJAT IN (
    SELECT ID_ANGAJAT
    FROM Departament
    WHERE NUME_DEPARTAMENT = 'Depart HR'
);

DELETE FROM Contract
WHERE ID_CONTRACT IN (
    SELECT ID_CONTRACT
    FROM Director
    WHERE SALARIU_DIRECTOR < 5000
);


UPDATE Director D
SET SALARIU_DIRECTOR = SALARIU_DIRECTOR * 1.1
WHERE ID_DIRECTOR IN (
    SELECT C.ID_DIRECTOR
    FROM Contract C
    JOIN Proiect P ON C.ID_PROIECT = P.ID_PROIECT
    WHERE P.STADIU_PROIECT = 1
);

SELECT D.NUME_DIRECTOR, P.STADIU_PROIECT
FROM Director D
JOIN Contract C ON D.ID_DIRECTOR = C.ID_DIRECTOR
JOIN Proiect P ON C.ID_PROIECT = P.ID_PROIECT
WHERE P.STADIU_PROIECT = 1
GROUP BY D.NUME_DIRECTOR, P.STADIU_PROIECT
HAVING COUNT(*) >= 1;



SELECT D.NUME_DIRECTOR, P.NUME_PROIECT
FROM Director D
JOIN Contract C ON D.ID_DIRECTOR = C.ID_DIRECTOR
JOIN Proiect P ON C.ID_PROIECT = P.ID_PROIECT
WHERE D.SALARIU_DIRECTOR > (
    SELECT AVG(D2.SALARIU_DIRECTOR)
    FROM Director D2
    JOIN Contract C2 ON D2.ID_DIRECTOR = C2.ID_DIRECTOR
    JOIN Proiect P2 ON C2.ID_PROIECT = P2.ID_PROIECT
    WHERE P2.STADIU_PROIECT = 1
);



UPDATE Director D
SET SALARIU_DIRECTOR = SALARIU_DIRECTOR * 1.1
WHERE ID_DIRECTOR IN (
    SELECT C.ID_DIRECTOR
    FROM Contract C
    JOIN Proiect P ON C.ID_PROIECT = P.ID_PROIECT
    WHERE P.STADIU_PROIECT = 1
);
